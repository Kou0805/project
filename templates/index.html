{% extends "layout.html" %}

{% block title %}
Index
{% endblock %}

{% block headline %}
{{ title }}
{% endblock %}

{% block content %}
<div class="mb-3" id="msg">{{ message }}</div>

<!-- Vue.js entry point -->
<div id="app" class="m-3">
    {% raw %}
      <mycomp/>
    {% endraw %}
</div>

<!-- mycomp's template -->

{% raw %}
<script type="text/x-template" id="mycomp-template">
    <div>
        <div class="alert alert-info">
            <h5>{{alert}}</h5>
        </div>
        <div class="form-group">
            <label for="id">Name</label>
            <input type="text" class="form-control"
                id="name" v-model="f_name">
        </div>
        <div class="form-group">
            <label for="id">Mail</label>
            <input type="email" class="form-control"
                id="mail" v-model="f_mail">
        </div>
        <div class="form-group">
            <label for="age">Age</label>
            <input type="number" class="form-control"
                id="age" v-model="f_age">
        </div>
        <div class="form-group">
            <button class="btn btn-primary"
                v-on:click="action">Add</button>
        </div>
        <hr>
        <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Mail</th>
                <th>Age</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="item in data">
                <th>{{item.id}}</th>
                <td>{{item.name}}</td>
                <td>{{item.mail}}</td>
                <td>{{item.age}}</td>
            </tr>
        </tbody>
        </table>
    </div>
</script>
{% endraw %}
<!--vue.js script-->
<script>
  Vue.component('mycomp', {
    template: '#mycomp-template',
    data: function() {
        return {
            f_name:'',
            f_mail:'',
            f_age:0,
            alert:'データを追加してね.',
            data: [(-1,'wait...','','')]
        }
    },
    methods:{
      getdata: function() {
          let self = this;
          $.get('/ajax', function(data){
            self.data = eval(data).reverse()
          });
      },

      action: function() {
        let formData = new FormData();
        formData.append('name',this.f_name);
        formData.append('mail',this.f_mail);
        formData.append('age',this.f_age);
        let self = this;
        $.ajax({
          type:'POST',
          url:'/form',
          data: formData,
          processData:false,
          contentType:false,

          success: function(data){
            self.f_name='';
            self.f_mail='';
            self.f_age=0;
            self.getdata();
          },
          error: function(request,status,err) {
            console.log(err);
          }
        });
      }
  },
  created: function() {
    this.getdata();
  }
});


// start Vue.
new Vue({
  el:'#app',
});

</script>
{% endblock %}


{% block footer %}
copyright 2019 SYODA-Tuyano.
{% endblock %}
